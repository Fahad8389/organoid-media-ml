# Media Recipe Generator - Final Report

## Overview

This report summarizes the performance of the Media Recipe Generator ML system,
which predicts organoid media factor concentrations from clinical and genomic profiles.

## Model Architecture

- **Per-factor models**: Each media factor has its own model
- **Regression factors**: egf, cholera_toxin (GradientBoostingRegressor)
- **Binary factors**: y27632, n_acetyl_cysteine, a83_01, sb202190, fgf2 (GradientBoostingClassifier)
- **Constant factors**: insulin (insufficient data, n=5)

## Cross-Validation Results

```
              factor         model_type  n_samples          cv_method  n_folds  mae_mean   mae_std  rmse_mean  rmse_std   r2_mean    r2_std  accuracy_mean  accuracy_std   f1_mean    f1_std  auc_mean   auc_std
0                egf         regression        256             5-fold        5  0.061972  0.010070   0.158087  0.075564  0.964226  0.041190            NaN           NaN       NaN       NaN       NaN       NaN
1             y27632  binary_classifier        660  5-fold Stratified        5       NaN       NaN        NaN       NaN       NaN       NaN       0.809091      0.026418  0.726529  0.051397  0.892808  0.018824
2  n_acetyl_cysteine  binary_classifier        660  5-fold Stratified        5       NaN       NaN        NaN       NaN       NaN       NaN       0.809091      0.016177  0.635505  0.027530  0.891401  0.014227
3             a83_01  binary_classifier        660  5-fold Stratified        5       NaN       NaN        NaN       NaN       NaN       NaN       0.809091      0.016177  0.635505  0.027530  0.891401  0.014227
4           sb202190  binary_classifier        660  5-fold Stratified        5       NaN       NaN        NaN       NaN       NaN       NaN       0.915152      0.017539  0.623429  0.087916  0.941308  0.023071
5               fgf2  binary_classifier        660  5-fold Stratified        5       NaN       NaN        NaN       NaN       NaN       NaN       0.945455      0.008835  0.749505  0.059936  0.960855  0.024778
6      cholera_toxin         regression         25             3-fold        3  0.474940  0.106051   0.658436  0.134012  0.481176  0.167107            NaN           NaN       NaN       NaN       NaN       NaN
7            insulin           constant          5                N/A        0       NaN       NaN        NaN       NaN       NaN       NaN            NaN           NaN       NaN       NaN       NaN       NaN
```

## Recipe-Level Metrics

- **Total Samples**: 660
- **Total Factors**: 8
- **Exact Match Rate**: 0.00%
- **Partial Match Rate**: 66.52%
- **Weighted Recipe Score**: 71.65%

## Regression Performance

- **Weighted RÂ²**: 0.9859
- **Mean MAE**: 0.1123

## Classification Performance

- **Mean F1 Score**: 0.9588

## Gene-Media Importance Matrix

Top genes driving each media factor prediction:

```
                              egf    y27632  n_acetyl_cysteine    a83_01  sb202190      fgf2  cholera_toxin
APC_vaf              7.863552e-04  0.029115           0.004914  0.004914  0.200073  0.128495   0.000000e+00
wnt_pathway_max_vaf  8.822563e-04  0.027378           0.015746  0.015746  0.037049  0.047330   0.000000e+00
RYR2_vaf             1.726462e-03  0.012426           0.028369  0.028369  0.000000  0.000000   0.000000e+00
FLG_vaf              4.554818e-04  0.007383           0.008797  0.008797  0.001818  0.000000   3.427170e-02
TP53_vaf             1.371198e-17  0.010517           0.021248  0.021248  0.000000  0.002146   0.000000e+00
p53_pathway_max_vaf  1.722572e-04  0.027427           0.009067  0.009067  0.001106  0.003919   5.737144e-17
DNAH5_vaf            1.533953e-03  0.009865           0.008290  0.008290  0.021662  0.000000   0.000000e+00
CCDC168_vaf          1.589464e-04  0.000000           0.001957  0.001957  0.000000  0.001255   4.390879e-02
ras_pathway_max_vaf  1.568799e-16  0.009393           0.010770  0.010770  0.017410  0.000756   0.000000e+00
RYR1_vaf             4.654559e-05  0.005686           0.010160  0.010160  0.000517  0.020845   0.000000e+00
```

## Files Generated

- `model_artifacts/`: Trained model files (.joblib)
- `outputs/final_metrics.json`: Detailed metrics in JSON format
- `outputs/cv_results.csv`: Cross-validation results
- `outputs/gene_media_matrix.csv`: Gene-media importance matrix
- `data/preprocessing_metadata.json`: Preprocessing configuration

## Usage

```python
from src.models import MediaRecipeGenerator
from src.preprocessing import MediaRecipePreprocessor

# Load models
generator = MediaRecipeGenerator.load_models('model_artifacts/')
preprocessor = MediaRecipePreprocessor.load_metadata('data/preprocessing_metadata.json')

# Predict for new sample
X_new = preprocessor.transform(new_patient_data)
recipe = generator.predict(X_new)
```

---
*Generated by Media Recipe Generator ML Pipeline*